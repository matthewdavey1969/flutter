// This code was generated by flutter-go-bridge. Do not manually edit.
package main

import (
	"errors"
	"fmt"
	"unsafe"

	orig "{{projectName}}/src"
	"github.com/csnewman/flutter-go-bridge/runtime"
)

/*
#include <stdlib.h>
#include <stdint.h>

typedef struct {
	int res;
	void* err;
} fgb_ret_sum;

typedef struct {
	int res;
	void* err;
} fgb_ret_sum_long_running;
*/
import "C"

var ErrDart = errors.New("dart")

// Required by cgo
func main() {}

func mapToString(from unsafe.Pointer) string {
	res := C.GoString((*C.char)(from))
	C.free(from)
	return res
}

func mapFromString(from string) unsafe.Pointer {
	return unsafe.Pointer(C.CString(from))
}

func mapToError(from unsafe.Pointer) error {
	res := C.GoString((*C.char)(from))
	C.free(from)
	return fmt.Errorf("%w: %v", ErrDart, res)
}

func mapFromError(from error) unsafe.Pointer {
	return unsafe.Pointer(C.CString(from.Error()))
}

//export fgb_sum
func fgb_sum(arg_a C.int, arg_b C.int) (resw C.fgb_ret_sum) {
	defer func() {
		r := recover()
		if r == nil {
			return
		}

		resw = C.fgb_ret_sum{
			err: unsafe.Pointer(C.CString(fmt.Sprintf("panic: %v", r))),
		}
	}()

	arggo_a := (int)(arg_a)
	arggo_b := (int)(arg_b)
	gres := orig.Sum(arggo_a, arggo_b)

	cres := (C.int)(gres)

	return C.fgb_ret_sum{
		res: cres,
	}
}

//export fgbasync_sum
func fgbasync_sum(arg_a C.int, arg_b C.int, fgbPort int64) {
	go func() {
		value := fgb_sum(arg_a, arg_b)
		ptr := runtime.Pin(value)
		h := uint64(ptr)

		sent := runtime.Send(fgbPort, []uint64{h}, func() {
			runtime.FreePin(ptr)
		})
		if !sent {
			runtime.FreePin(ptr)
		}
	}()
}

//export fgbasyncres_sum
func fgbasyncres_sum(h uint64) C.fgb_ret_sum {
	ptr := uintptr(h)
	return runtime.GetPin[C.fgb_ret_sum](ptr)
}

//export fgb_sum_long_running
func fgb_sum_long_running(arg_a C.int, arg_b C.int) (resw C.fgb_ret_sum_long_running) {
	defer func() {
		r := recover()
		if r == nil {
			return
		}

		resw = C.fgb_ret_sum_long_running{
			err: unsafe.Pointer(C.CString(fmt.Sprintf("panic: %v", r))),
		}
	}()

	arggo_a := (int)(arg_a)
	arggo_b := (int)(arg_b)
	gres := orig.SumLongRunning(arggo_a, arggo_b)

	cres := (C.int)(gres)

	return C.fgb_ret_sum_long_running{
		res: cres,
	}
}

//export fgbasync_sum_long_running
func fgbasync_sum_long_running(arg_a C.int, arg_b C.int, fgbPort int64) {
	go func() {
		value := fgb_sum_long_running(arg_a, arg_b)
		ptr := runtime.Pin(value)
		h := uint64(ptr)

		sent := runtime.Send(fgbPort, []uint64{h}, func() {
			runtime.FreePin(ptr)
		})
		if !sent {
			runtime.FreePin(ptr)
		}
	}()
}

//export fgbasyncres_sum_long_running
func fgbasyncres_sum_long_running(h uint64) C.fgb_ret_sum_long_running {
	ptr := uintptr(h)
	return runtime.GetPin[C.fgb_ret_sum_long_running](ptr)
}
